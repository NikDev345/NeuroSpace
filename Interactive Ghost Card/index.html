<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Merged Hyper-Realistic 3D Planet Card</title>

  <link rel="stylesheet" href="style.css" />

  <!-- Import map for ES modules -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
      "lil-gui": "https://unpkg.com/lil-gui@0.19.1/dist/lil-gui.esm.min.js"
    }
  }
  </script>
</head>
<body>

<div id="loading">INITIALIZING NEURAL LINK...</div>
<div id="world"></div>
<div id="hint">MOVE YOUR MOUSE TO TILT â€¢ SCROLL TO ZOOM</div>

<!-- EARTH VERTEX SHADER -->
<script type="x-shader/x-vertex" id="vertexShader">
  varying vec2 vUv;
  varying vec3 vNormal;
  varying vec3 vPosition;

  void main() {
    vUv = uv;
    vNormal = normalize(normalMatrix * normal);
    vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
</script>

<!-- EARTH FRAGMENT SHADER (Day/Night/Clouds/Specular) -->
<script type="x-shader/x-fragment" id="fragmentShader">
  uniform sampler2D dayTexture;
  uniform sampler2D nightTexture;
  uniform sampler2D specularTexture;
  uniform sampler2D cloudTexture;
  uniform vec3 sunDirection;
  uniform float brightness;

  varying vec2 vUv;
  varying vec3 vNormal;
  varying vec3 vPosition;

  void main() {
    vec3 viewDir = normalize(-vPosition);
    vec3 normal = normalize(vNormal);
    vec3 sunDir = normalize(sunDirection);

    float NdotL = dot(normal, sunDir);
    float dayMix = smoothstep(-0.2, 0.2, NdotL);

    vec3 dayColor = texture2D(dayTexture, vUv).rgb;
    vec3 nightColor = texture2D(nightTexture, vUv).rgb;
    float clouds = texture2D(cloudTexture, vUv).r;
    float specMap = texture2D(specularTexture, vUv).r;

    vec3 reflectDir = reflect(-sunDir, normal);
    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 32.0);
    vec3 specular = vec3(0.5) * spec * specMap * dayMix;

    vec3 daySide = mix(dayColor, vec3(1.0), clouds * 0.9) + specular;
    vec3 nightSide = nightColor * (1.0 - clouds * 0.95);

    vec3 finalColor = mix(nightSide, daySide, dayMix);

    if (dayMix < 0.2) {
      float scattering = (1.0 - dayMix) * 0.2;
      finalColor += vec3(0.0, 0.02, 0.05) * scattering;
    }

    finalColor *= brightness;

    gl_FragColor = vec4(finalColor, 1.0);
  }
</script>

<!-- ATMOSPHERE SHADERS -->
<script type="x-shader/x-vertex" id="atmosphereVertex">
  varying vec3 vNormal;
  void main() {
    vNormal = normalize(normalMatrix * normal);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
</script>

<script type="x-shader/x-fragment" id="atmosphereFragment">
  varying vec3 vNormal;
  uniform vec3 glowColor;
  uniform float bias;
  uniform float power;
  uniform float intensity;

  void main() {
    float a = pow(bias - dot(vNormal, vec3(0, 0, 1.0)), power);
    gl_FragColor = vec4(glowColor, 1.0) * a * intensity;
  }
</script>

<!-- Main JS (separated) -->
<script type="module" src="script.js"></script>
</body>
</html>
